import{d as z,r as c,k as I,y as O,f as j,p as G,c as v,a as t,q as y,b as l,w as o,e as u,t as D,x as r,g as _,F as J,n as K,o as p,E as P,_ as Q}from"./index-D0gD-nMH.js";import{a as W,c as X}from"./task-BMeBlA8s.js";const Y={class:"task-detail container"},Z={key:0,class:"layout-grid"},ee={class:"content-panel"},te={class:"panel-card"},ae={class:"task-header"},le={class:"task-h1"},se={class:"task-meta-row"},oe={class:"meta-tag"},ne={class:"meta-tag"},ie={class:"task-body"},de=["innerHTML"],re={key:0,class:"panel-card members-section"},ue={class:"members-grid"},me={class:"m-avatar"},ce={class:"m-info"},ve={class:"m-name"},pe={class:"side-panel"},fe={class:"stat-card highlight-card"},_e={class:"xp-val"},ge={class:"stat-card countdown-card"},be={key:0,class:"action-card"},ke={key:0,class:"optional-fields"},ye=z({__name:"TaskDetail",setup(we){const T=O(),w=c(!1),s=c(null),f=c(!1),V=c(!1),x=c(),g=c(!1),i=c({memberName:"",memberEmail:"",title:"",content:"",deadline:""}),L={memberName:[{required:!0,message:"请输入姓名",trigger:"blur"}],memberEmail:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:"blur"}]};I(()=>N());async function N(){w.value=!0;try{const n=await W(Number(T.params.id));s.value=n.data}finally{w.value=!1}}async function h(){var e;if(await((e=x.value)==null?void 0:e.validate().catch(()=>!1))){V.value=!0;try{await X(Number(T.params.id),{...i.value}),P.success("认领成功，请等待管理员审核"),f.value=!1,await N()}finally{V.value=!1}}}function U(n){return new Date(n).toLocaleDateString()}function H(n){return["s-pending","s-review","s-progress","s-done"][n]}function M(n){const e=new Date(n),m=new Date;m.setHours(0,0,0,0),e.setHours(0,0,0,0);const d=Math.ceil((e.getTime()-m.getTime())/(1e3*60*60*24));return d<0?"已过期":d===0?"今天截止":`还剩 ${d} 天`}function $(n){const e=new Date(n),m=new Date;m.setHours(0,0,0,0),e.setHours(0,0,0,0);const d=Math.ceil((e.getTime()-m.getTime())/(1e3*60*60*24));return d<=0?"urgent":d<=3?"warning":"normal"}return(n,e)=>{var E;const m=u("ArrowLeft"),d=u("el-icon"),F=u("User"),R=u("Calendar"),C=u("el-button"),b=u("el-input"),k=u("el-form-item"),q=u("el-form"),A=u("el-dialog"),B=G("loading");return j((p(),v("div",Y,[t("div",{class:"nav-back",onClick:e[0]||(e[0]=a=>n.$router.push("/"))},[l(d,null,{default:o(()=>[l(m)]),_:1}),e[9]||(e[9]=t("span",null,"返回任务榜",-1))]),s.value?(p(),v("div",Z,[t("div",ee,[t("div",te,[t("div",ae,[t("span",{class:D(["status-pill",H(s.value.status)])},r(s.value.statusText),3),t("h1",le,r(s.value.title),1),t("div",se,[t("span",oe,[l(d,null,{default:o(()=>[l(F)]),_:1}),_(" "+r(((E=s.value.members)==null?void 0:E.length)||0)+" 位参与者 ",1)]),t("span",ne,[l(d,null,{default:o(()=>[l(R)]),_:1}),_(" "+r(U(s.value.deadline)),1)])])]),e[11]||(e[11]=t("div",{class:"divider"},null,-1)),t("div",ie,[e[10]||(e[10]=t("h3",{class:"section-title"},"任务描述",-1)),t("div",{class:"rich-text",innerHTML:s.value.content||"暂无描述"},null,8,de)])]),s.value.members&&s.value.members.length>0?(p(),v("div",re,[e[12]||(e[12]=t("h3",{class:"section-title"},"参与成员",-1)),t("div",ue,[(p(!0),v(J,null,K(s.value.members,a=>(p(),v("div",{key:a.id,class:"member-chip"},[t("div",me,r(a.memberName.charAt(0)),1),t("div",ce,[t("div",ve,r(a.memberName),1),t("div",{class:D(["m-status","s-"+a.status])},r(a.statusText),3)])]))),128))])])):y("",!0)]),t("div",pe,[t("div",fe,[e[13]||(e[13]=t("div",{class:"xp-label"},"奖励",-1)),t("div",_e,r(s.value.reward),1),e[14]||(e[14]=t("div",{class:"xp-unit"},"积分",-1))]),t("div",ge,[e[15]||(e[15]=t("div",{class:"cd-label"},"剩余时间",-1)),t("div",{class:D(["cd-val",$(s.value.deadline)])},r(M(s.value.deadline)),3)]),s.value.status===0||s.value.status===1?(p(),v("div",be,[l(C,{type:"primary",class:"claim-btn",onClick:e[1]||(e[1]=a=>f.value=!0)},{default:o(()=>[...e[16]||(e[16]=[_(" 认领任务 ",-1)])]),_:1}),e[17]||(e[17]=t("p",{class:"action-note"},"认领后需等待管理员审核",-1))])):y("",!0)])])):y("",!0),l(A,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=a=>f.value=a),title:"认领任务",width:"500px","align-center":""},{footer:o(()=>[l(C,{onClick:e[7]||(e[7]=a=>f.value=!1)},{default:o(()=>[...e[18]||(e[18]=[_("取消",-1)])]),_:1}),l(C,{type:"primary",onClick:h,loading:V.value},{default:o(()=>[...e[19]||(e[19]=[_(" 确认认领 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[e[20]||(e[20]=t("p",{class:"dialog-desc"},"请填写您的信息以认领此任务",-1)),l(q,{model:i.value,rules:L,ref_key:"claimFormRef",ref:x,"label-position":"top"},{default:o(()=>[l(k,{label:"您的姓名",prop:"memberName"},{default:o(()=>[l(b,{modelValue:i.value.memberName,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.memberName=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(k,{label:"邮箱地址",prop:"memberEmail"},{default:o(()=>[l(b,{modelValue:i.value.memberEmail,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.memberEmail=a),placeholder:"用于接收通知"},null,8,["modelValue"])]),_:1}),t("div",{class:"optional-toggle",onClick:e[4]||(e[4]=a=>g.value=!g.value)},r(g.value?"收起":"展开")+"可选修改项 ",1),g.value?(p(),v("div",ke,[l(k,{label:"修改任务标题"},{default:o(()=>{var a;return[l(b,{modelValue:i.value.title,"onUpdate:modelValue":e[5]||(e[5]=S=>i.value.title=S),placeholder:(a=s.value)==null?void 0:a.title},null,8,["modelValue","placeholder"])]}),_:1}),l(k,{label:"修改任务描述"},{default:o(()=>[l(b,{modelValue:i.value.content,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.content=a),type:"textarea"},null,8,["modelValue"])]),_:1})])):y("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])),[[B,w.value]])}}}),De=Q(ye,[["__scopeId","data-v-628c5cd7"]]);export{De as default};

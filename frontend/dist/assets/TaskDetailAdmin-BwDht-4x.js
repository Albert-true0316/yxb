import{d as ae,r as v,A as le,j as se,k as ne,y as oe,f as ie,p as ue,c as k,a as o,q as x,b as t,w as a,e as i,x as b,g as u,h as M,o as m,F as re,L as $,E as V,s as me,_ as de}from"./index-D0gD-nMH.js";import{f as pe,h as ce,r as fe,i as ve,j as be,k as _e}from"./task-BMeBlA8s.js";const ge={class:"task-detail-admin"},ye={class:"back-link"},ke={key:0,class:"detail-card"},we={class:"detail-header"},Ce={class:"task-title"},Ne={class:"reward-badge"},Ve={class:"reward-value"},Ee={class:"detail-meta"},xe={class:"detail-content"},Me=["innerHTML"],Te={class:"members-section"},$e={class:"section-header"},De={key:0,class:"points"},Ae={key:1},Re={key:0,class:"actions"},Se={class:"dialog-tip"},Fe=ae({__name:"TaskDetailAdmin",setup(Ue){const _=oe();me();const T=v(!1),n=v(null),w=v(!1),C=v(!1),g=v(!1),D=v(),E=v({}),d=le({memberName:"",memberEmail:""}),L={memberName:[{required:!0,message:"请输入姓名",trigger:"blur"}],memberEmail:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},P=se(()=>{var s,e;return((e=(s=n.value)==null?void 0:s.members)==null?void 0:e.filter(c=>c.status===1))||[]});ne(async()=>{await y()});async function y(){var s;T.value=!0;try{const e=Number(_.params.id),c=await pe(e);n.value=c.data,(s=n.value)!=null&&s.members&&n.value.members.forEach(f=>{f.status===1&&(E.value[f.id]=0)})}finally{T.value=!1}}async function z(s){await $.confirm("确认通过该成员的认领申请？","确认"),await ce(Number(_.params.id),s),V.success("已通过"),await y()}async function h(s){await $.confirm("确认拒绝该成员的认领申请？","确认"),await fe(Number(_.params.id),s),V.success("已拒绝"),await y()}async function q(s){await $.confirm("确认移除该成员？","确认",{type:"warning"}),await ve(Number(_.params.id),s),V.success("已移除"),await y()}async function I(){var e;if(await((e=D.value)==null?void 0:e.validate().catch(()=>!1))){g.value=!0;try{await be(Number(_.params.id),{memberName:d.memberName,memberEmail:d.memberEmail}),V.success("分配成功"),w.value=!1,d.memberName="",d.memberEmail="",await y()}finally{g.value=!1}}}async function H(){const s=Object.entries(E.value).map(([e,c])=>({memberId:Number(e),points:c}));g.value=!0;try{await _e(Number(_.params.id),s),V.success("任务已完成"),C.value=!1,await y()}finally{g.value=!1}}function O(s){const e=new Date(s);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function Y(s){return{0:"info",1:"warning",2:"primary",3:"success"}[s]||"info"}function G(s){return{0:"warning",1:"success",2:"info"}[s]||"info"}return(s,e)=>{var j;const c=i("ArrowLeft"),f=i("el-icon"),r=i("el-button"),A=i("el-tag"),J=i("Calendar"),K=i("Plus"),p=i("el-table-column"),R=i("el-table"),Q=i("el-empty"),W=i("CircleCheck"),S=i("el-input"),F=i("el-form-item"),X=i("el-form"),U=i("el-dialog"),Z=i("el-input-number"),ee=ue("loading");return ie((m(),k("div",ge,[o("div",ye,[t(r,{link:"",onClick:e[0]||(e[0]=l=>s.$router.push("/admin/tasks"))},{default:a(()=>[t(f,null,{default:a(()=>[t(c)]),_:1}),e[9]||(e[9]=u(" 返回任务列表 ",-1))]),_:1})]),n.value?(m(),k("div",ke,[o("div",we,[o("div",null,[t(A,{type:Y(n.value.status),size:"large"},{default:a(()=>[u(b(n.value.statusText),1)]),_:1},8,["type"]),o("h1",Ce,b(n.value.title),1)]),o("div",Ne,[o("span",Ve,b(n.value.reward),1),e[10]||(e[10]=o("span",{class:"reward-label"},"积分",-1))])]),o("div",Ee,[o("span",null,[t(f,null,{default:a(()=>[t(J)]),_:1}),u(" 截止："+b(O(n.value.deadline)),1)])]),o("div",xe,[e[11]||(e[11]=o("h3",null,"任务描述",-1)),o("div",{class:"content-html",innerHTML:n.value.content||"暂无描述"},null,8,Me)]),o("div",Te,[o("div",$e,[e[13]||(e[13]=o("h3",null,"参与成员",-1)),n.value.status!==3?(m(),M(r,{key:0,size:"small",onClick:e[1]||(e[1]=l=>w.value=!0)},{default:a(()=>[t(f,null,{default:a(()=>[t(K)]),_:1}),e[12]||(e[12]=u(" 直接分配 ",-1))]),_:1})):x("",!0)]),((j=n.value.members)==null?void 0:j.length)>0?(m(),M(R,{key:0,data:n.value.members},{default:a(()=>[t(p,{prop:"memberName",label:"姓名",width:"120"}),t(p,{prop:"memberEmail",label:"邮箱","min-width":"200"}),t(p,{prop:"statusText",label:"状态",width:"100"},{default:a(({row:l})=>[t(A,{type:G(l.status)},{default:a(()=>[u(b(l.statusText),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"earnedPoints",label:"获得积分",width:"100"},{default:a(({row:l})=>[l.earnedPoints>0?(m(),k("span",De,"+"+b(l.earnedPoints),1)):(m(),k("span",Ae,"-"))]),_:1}),t(p,{label:"操作",width:"180"},{default:a(({row:l})=>[l.status===0?(m(),k(re,{key:0},[t(r,{link:"",type:"success",onClick:N=>z(l.id)},{default:a(()=>[...e[14]||(e[14]=[u("通过",-1)])]),_:1},8,["onClick"]),t(r,{link:"",type:"danger",onClick:N=>h(l.id)},{default:a(()=>[...e[15]||(e[15]=[u("拒绝",-1)])]),_:1},8,["onClick"])],64)):l.status===1&&n.value.status===2?(m(),M(r,{key:1,link:"",type:"danger",onClick:N=>q(l.id)},{default:a(()=>[...e[16]||(e[16]=[u("移除",-1)])]),_:1},8,["onClick"])):x("",!0)]),_:1})]),_:1},8,["data"])):(m(),M(Q,{key:1,description:"暂无成员"}))]),n.value.status===2?(m(),k("div",Re,[t(r,{type:"success",size:"large",onClick:e[2]||(e[2]=l=>C.value=!0)},{default:a(()=>[t(f,null,{default:a(()=>[t(W)]),_:1}),e[17]||(e[17]=u(" 完成任务并分配积分 ",-1))]),_:1})])):x("",!0)])):x("",!0),t(U,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=l=>w.value=l),title:"直接分配成员",width:"500px"},{footer:a(()=>[t(r,{onClick:e[5]||(e[5]=l=>w.value=!1)},{default:a(()=>[...e[18]||(e[18]=[u("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:I,loading:g.value},{default:a(()=>[...e[19]||(e[19]=[u("分配",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(X,{model:d,rules:L,ref_key:"assignFormRef",ref:D,"label-width":"80px"},{default:a(()=>[t(F,{label:"姓名",prop:"memberName"},{default:a(()=>[t(S,{modelValue:d.memberName,"onUpdate:modelValue":e[3]||(e[3]=l=>d.memberName=l),placeholder:"成员姓名"},null,8,["modelValue"])]),_:1}),t(F,{label:"邮箱",prop:"memberEmail"},{default:a(()=>[t(S,{modelValue:d.memberEmail,"onUpdate:modelValue":e[4]||(e[4]=l=>d.memberEmail=l),placeholder:"成员邮箱"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(U,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=l=>C.value=l),title:"完成任务 - 分配积分",width:"600px"},{footer:a(()=>[t(r,{onClick:e[7]||(e[7]=l=>C.value=!1)},{default:a(()=>[...e[22]||(e[22]=[u("取消",-1)])]),_:1}),t(r,{type:"success",onClick:H,loading:g.value},{default:a(()=>[...e[23]||(e[23]=[u("确认完成",-1)])]),_:1},8,["loading"])]),default:a(()=>{var l;return[o("p",Se,[e[20]||(e[20]=u("任务总积分：",-1)),o("strong",null,b((l=n.value)==null?void 0:l.reward),1),e[21]||(e[21]=u("，请为每位成员分配积分。",-1))]),t(R,{data:P.value},{default:a(()=>[t(p,{prop:"memberName",label:"姓名",width:"120"}),t(p,{prop:"memberEmail",label:"邮箱"}),t(p,{label:"分配积分",width:"150"},{default:a(({row:N})=>{var B;return[t(Z,{modelValue:E.value[N.id],"onUpdate:modelValue":te=>E.value[N.id]=te,min:0,max:(B=n.value)==null?void 0:B.reward,size:"small"},null,8,["modelValue","onUpdate:modelValue","max"])]}),_:1})]),_:1},8,["data"])]}),_:1},8,["modelValue"])])),[[ee,T.value]])}}}),Le=de(Fe,[["__scopeId","data-v-9ba228ed"]]);export{Le as default};
